<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - StudyLog</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #000000; color: #ffffff; font-family: 'Segoe UI', sans-serif; padding-top: 80px; }
        .navbar { background-color: #000000; border-bottom: 1px solid #1c1f24; padding: 15px 0; }
        .navbar-brand { font-weight: 800; color: #fff !important; font-size: 1.5rem; letter-spacing: -1px; }
        .navbar-brand span { color: #10b981; }
        .nav-link { color: #888 !important; font-weight: 600; margin-left: 20px; transition: 0.3s; }
        .nav-link:hover, .nav-link.active { color: #10b981 !important; }
        .btn-logout { border: 1px solid #333; color: #888; border-radius: 50px; padding: 5px 15px; font-size: 0.9rem; transition: 0.3s; background: transparent;}
        .btn-logout:hover { border-color: #ef4444; color: #ef4444; }
        .card-kpi { background-color: #1c1f24; border: 1px solid #2d333b; border-radius: 12px; padding: 20px; transition: transform 0.2s; position: relative; overflow: hidden; }
        .card-kpi:hover { transform: translateY(-5px); border-color: #10b981; }
        .kpi-title { font-size: 0.85rem; color: #10b981; text-transform: uppercase; font-weight: 700; letter-spacing: 1px; }
        .kpi-value { font-size: 2.5rem; font-weight: 800; color: #fff; margin: 10px 0; }
        .kpi-icon { position: absolute; top: 20px; right: 20px; font-size: 2rem; color: #10b981; opacity: 0.2; }
        .card-chart { background-color: #1c1f24; border: 1px solid #2d333b; border-radius: 12px; padding: 20px; }
        .chart-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 20px; color: #fff; }
        .progress { background-color: #333; height: 10px; border-radius: 5px; }
        .progress-bar { background-color: #10b981; }
        .form-select-dark { background-color: #2b3038; border: 1px solid #444c56; color: #fff; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/">üöÄ StudyLog<span>.PRO</span></a>
            <button class="navbar-toggler bg-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link active" href="/">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="/historico">Hist√≥rico</a></li>
                    <li class="nav-item"><a class="nav-link" href="/novo">Novo Estudo</a></li>
                </ul>
                <div class="d-flex align-items-center gap-3">
                    <a href="/perfil" class="text-decoration-none fw-bold text-white small">
                        Ol√°, <span th:text="${nomeUsuario}" class="text-success">Estudante</span>
                    </a>
                    <form th:action="@{/logout}" method="post" class="m-0">
                        <button class="btn-logout" type="submit"><i class="bi bi-box-arrow-right"></i> Sair</button>
                    </form>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-end mb-5">
            <div>
                <h2 class="fw-bold m-0">Vis√£o Geral</h2>
                <p class="text-secondary m-0">Acompanhe sua evolu√ß√£o.</p>
            </div>
            <form action="/" method="get" class="d-flex gap-2">
                <select name="dias" class="form-select form-select-sm form-select-dark" style="width: 150px;" onchange="this.form.submit()">
                    <option value="7" th:selected="${periodoSelecionado == 7}">√öltimos 7 dias</option>
                    <option value="30" th:selected="${periodoSelecionado == 30}">√öltimos 30 dias</option>
                    <option value="365" th:selected="${periodoSelecionado == 365}">Este Ano</option>
                </select>
            </form>
        </div>

        <div class="row g-4 mb-5">
            <div class="col-md-3">
                <div class="card-kpi">
                    <div class="kpi-title">Quest√µes Feitas</div>
                    <div class="kpi-value" th:text="${kpiTotal}">0</div>
                    <i class="bi bi-stack kpi-icon"></i>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card-kpi">
                    <div class="kpi-title">Aproveitamento</div>
                    <div class="kpi-value" style="color: #10b981;">
                        <span th:text="${kpiPorcentagem}">0</span>%
                    </div>
                    <div class="progress mt-2">
                        <div class="progress-bar" role="progressbar" th:style="'width: ' + ${kpiPorcentagem} + '%'"></div>
                    </div>
                    <i class="bi bi-graph-up-arrow kpi-icon"></i>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card-kpi">
                    <div class="kpi-title">Reda√ß√µes</div>
                    <div class="kpi-value" th:text="${kpiRedacoes}">0</div>
                    <i class="bi bi-pencil-square kpi-icon"></i>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card-kpi" style="border-color: #f59e0b;">
                    <div class="kpi-title" style="color: #f59e0b;">Sequ√™ncia</div>
                    <div class="kpi-value" style="color: #f59e0b;">
                        <span th:text="${foguinho}">0</span> üî•
                    </div>
                    <i class="bi bi-fire kpi-icon" style="color: #f59e0b;"></i>
                </div>
            </div>
        </div>

        <div class="row g-4 mb-5">
            <div class="col-lg-8">
                <div class="card-chart h-100">
                    <div class="chart-title">Desempenho Di√°rio</div>
                    <canvas id="graficoPrincipal"></canvas>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card-chart h-100">
                    <div class="chart-title">Tempo por Mat√©ria</div>
                    <div style="height: 250px; display: flex; justify-content: center;">
                        <canvas id="graficoPizza"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        const colorGreen = '#10b981';
        const colorDark = '#1c1f24';
        const colorText = '#e0e0e0';
        const colorGrid = '#333333';

        const labels = /*[[${graficoLabels}]]*/ [];
        const dadosAcertos = /*[[${graficoAcertos}]]*/ [];
        const dadosErros = /*[[${graficoErros}]]*/ [];
        
        const pizzaLabels = /*[[${pizzaLabels}]]*/ [];
        const pizzaDados = /*[[${pizzaDados}]]*/ [];

        new Chart(document.getElementById('graficoPrincipal'), {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    { label: 'Acertos', data: dadosAcertos, backgroundColor: colorGreen, borderRadius: 4 },
                    { label: 'Erros', data: dadosErros, backgroundColor: '#ef4444', borderRadius: 4 }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    x: { ticks: { color: colorText }, grid: { display: false } },
                    y: { ticks: { color: colorText }, grid: { color: colorGrid } }
                },
                plugins: { legend: { labels: { color: colorText } } }
            }
        });

        new Chart(document.getElementById('graficoPizza'), {
            type: 'doughnut',
            data: {
                labels: pizzaLabels,
                datasets: [{
                    data: pizzaDados,
                    backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom', labels: { color: colorText, boxWidth: 12 } } }
            }
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>